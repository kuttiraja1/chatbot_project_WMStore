{% extends "base.html" %}

{% block title %}Welcome - My Flask App{% endblock %}

{% block content %}
<div class="text-center py-4 mb-4" style="background: linear-gradient(90deg,#7c3aed 0%,#06b6d4 100%); border-radius: .5rem; color:#fff;">
  <div class="container d-flex flex-column flex-md-row align-items-center justify-content-between">
    <div class="d-flex align-items-center gap-3">
      <div class="rounded-circle bg-white text-primary d-flex align-items-center justify-content-center" style="width:64px;height:64px;font-weight:700;">
        {{ username[0]|upper if username }}
      </div>
      <div>
        <h1 class="h4 mb-0">Welcome, {{ username }}!</h1>
        <p class="mb-0 text-white-50 small">You have successfully signed in — try the demo chatbot below.</p>
      </div>
    </div>

    <div class="mt-3 mt-md-0">
      <a class="btn btn-light btn-sm me-2" href="{{ url_for('index') }}">Home</a>
      <a class="btn btn-outline-light btn-sm" href="{{ url_for('login') }}">Sign in as someone else</a>
    </div>
  </div>
</div>

<div class="container mb-5">
  <div class="row g-4">
    <div class="col-12 col-lg-8">
      <div class="card shadow-sm" style="border-radius:12px; overflow:hidden;">
        <div class="card-header d-flex align-items-center justify-content-between p-3" style="background: linear-gradient(90deg,#06b6d4, #7c3aed); color:#fff;">
          <div>
            <strong class="d-block">Demo Chatbot</strong>
            <small class="d-block text-white-75">Choose a mode and start chatting</small>
          </div>

          <!-- Mode buttons -->
          <div class="btn-group" role="group" aria-label="Chat modes">
            <button type="button" class="btn btn-sm btn-outline-light mode-btn active" data-mode="local">Local DB</button>
            <button type="button" class="btn btn-sm btn-outline-light mode-btn" data-mode="ai">AI Mode</button>
          </div>
        </div>

        <div class="card-body chat-body p-3" id="chatBody" aria-live="polite" style="background: linear-gradient(180deg,#fbfdff,#ffffff); height:420px; overflow:auto;">
          <ul class="list-unstyled mb-0" id="messages"></ul>
        </div>

        <div class="card-footer bg-transparent p-3">
          <form id="chatForm" class="d-flex gap-2" onsubmit="return false;">
            <input id="chatInput" class="form-control form-control-lg" type="text" placeholder="Say hi, ask for the time, or type 'help'..." aria-label="Chat message" autocomplete="off">
            <button id="sendBtn" class="btn btn-primary btn-lg" type="submit">Send</button>
          </form>
          <div class="mt-2 small text-muted">Mode: <span id="currentModeBadge" class="fw-semibold">Local DB</span></div>
        </div>
      </div>
    </div>

    <aside class="col-12 col-lg-4">
      <div class="card h-100 shadow-sm" style="border-radius:12px;">
        <div class="card-body">
          <h5 class="card-title">Quick actions</h5>
          <p class="card-text text-muted">Try these example prompts to get started:</p>
          <div class="d-grid gap-2">
            <button class="btn btn-outline-primary btn-sm quick" data-msg="Hello">Say Hello</button>
            <button class="btn btn-outline-primary btn-sm quick" data-msg="What is the time?">Ask Time</button>
            <button class="btn btn-outline-primary btn-sm quick" data-msg="Help">Show Help</button>
          </div>

          <hr>

          <h6 class="mt-3">Chat rules</h6>
          <ul class="small text-muted">
            <li>Local DB mode: rule-based replies (greetings, time, help)</li>
            <li>AI mode: demo AI response (replace with real model)</li>
          </ul>
        </div>
      </div>
    </aside>
  </div>
</div>

<script>
/* mode toggle handling — initial mode is local */
document.addEventListener('DOMContentLoaded', function () {
  const modeButtons = document.querySelectorAll('.mode-btn');
  const modeBadge = document.getElementById('currentModeBadge');

  modeButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      modeButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const mode = btn.getAttribute('data-mode') || 'local';
      modeBadge.textContent = mode === 'ai' ? 'AI Mode' : 'Local DB';
      // expose current mode to chatbot.js via window.chatMode
      window.chatMode = mode;
    });
  });

  // set default mode
  window.chatMode = (document.querySelector('.mode-btn.active')?.getAttribute('data-mode')) || 'local';
});
</script>

<script src="{{ url_for('static', filename='js/chatbot.js') }}"></script>
{% endblock %}